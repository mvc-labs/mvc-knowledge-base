---
sidebar_position: 6
---

# P2SH(支付到脚本哈希)脚本

## 什么是P2SH输出？

P2SH（Pay-to-Script-Hash，即“支付到脚本哈希”）是比特币网络中一种强大的交易输出类型。它允许将复杂的条件和脚本隐藏在一个哈希值中，只有在实际花费时才需要公开这些脚本。这种机制极大地提高了比特币交易的灵活性和隐私性，同时简化了用户的操作。

## P2SH输出的结构

P2SH输出的锁定脚本（scriptPubKey）与P2PKH（Pay-to-PubKeyHash）输出类似，但它包含一个脚本哈希而不是公钥哈希。典型的P2SH锁定脚本如下：

```
OP_HASH160 <脚本哈希> OP_EQUAL
```

在这个脚本中：

- `OP_HASH160`：对栈顶的元素进行RIPEMD-160哈希运算（先进行SHA-256哈希，然后进行RIPEMD-160哈希）。
- `<脚本哈希>`：这是一个20字节的哈希值，表示锁定脚本的哈希。
- `OP_EQUAL`：检查栈顶的哈希值是否等于提供的脚本哈希。

## P2SH交易的特点

1. **灵活性**：P2SH输出允许使用复杂的脚本和条件，而这些脚本和条件在生成交易时并不需要公开。只有在花费时才需要提供完整的解锁脚本。
2. **隐私性**：由于锁定脚本在生成交易时被哈希隐藏，P2SH输出提高了交易的隐私性。观察者无法从交易输出中直接看到具体的条件和脚本。
3. **简单的地址格式**：P2SH地址以“3”开头，使其与其他类型的比特币地址区别开来。用户只需提供P2SH地址，无需了解背后的复杂脚本。

## P2SH交易的使用场景

P2SH输出在许多需要复杂条件的交易场景中非常有用。以下是一些典型的使用场景：

1. **多重签名**：P2SH输出可以用于多重签名账户，只有满足特定数量的签名者签名后，资金才能被花费。这简化了多重签名的管理。
2. **时间锁定**：P2SH输出可以包含时间锁定条件，使得资金在特定时间之前无法被花费。
3. **条件支付**：P2SH输出可以用于设置复杂的条件支付，如智能合约和去中心化应用（DApps）。

## P2SH交易的示例

以下是一个P2SH交易的简化示例：

1. **锁定脚本（scriptPubKey）**：
   ```
   OP_HASH160 <脚本哈希> OP_EQUAL
   ```

2. **解锁脚本（scriptSig）**：
   ```
   <解锁数据> <锁定脚本>
   ```

在这个示例中，锁定脚本包含一个脚本哈希。在花费时，解锁脚本需要提供满足条件的解锁数据和原始锁定脚本。

## 多重签名P2SH交易示例

假设我们有一个2-of-3的多重签名P2SH交易：

1. **锁定脚本（scriptPubKey）**：
   ```
   OP_HASH160 <多重签名脚本哈希> OP_EQUAL
   ```

2. **多重签名脚本**：
   ```
   2 <公钥1> <公钥2> <公钥3> 3 OP_CHECKMULTISIG
   ```

3. **解锁脚本（scriptSig）**：
   ```
   OP_0 <签名1> <签名2> <多重签名脚本>
   ```

在这个多重签名交易中，锁定脚本只包含多重签名脚本的哈希值。要花费这笔资金，解锁脚本需要提供两个签名和原始的多重签名脚本。

## 结论

P2SH输出是一种灵活且强大的比特币交易输出类型，允许使用复杂的条件和脚本，同时提高了隐私性和安全性。通过将复杂的脚本隐藏在哈希值中，P2SH输出简化了用户的操作，并为各种高级用例（如多重签名和时间锁定）提供了支持。理解P2SH输出对于全面掌握比特币的脚本系统和交易机制具有重要意义。
